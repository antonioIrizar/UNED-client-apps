// Generated by CoffeeScript 1.8.0
(function() {
  var Plot;

  Plot = (function() {
    Plot.prototype.resizeActive = null;

    Plot.prototype.dataPlot = null;

    Plot.prototype.options = null;

    Plot.prototype.chart = null;

    Plot.prototype.time = 0;

    Plot.prototype.alarma = null;

    Plot.prototype.options1 = null;

    Plot.prototype.initChart = false;

    Plot.prototype.data = [[]];

    Plot.prototype.realTime = null;

    Plot.prototype.inputCurrent = null;

    Plot.prototype.inputVoltage = null;

    Plot.prototype.workToDo = null;

    function Plot() {
      this.data = [[]];
      this.chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      this.resize();
      google.setOnLoadCallback(this.drawChart());

      /*
      window.addEventListener "resize", =>
          if @resizeActive 
              clearTimeout(@resizeActive)
          @resizeActive = setTimeout( =>
              @resize()
              @chart.draw(@dataPlot, @options)
          ,500)
       */
    }

    Plot.prototype.resize = function() {
      var height;
      if (window.innerWidth >= 1200) {
        height = document.getElementById("div_formula_col").offsetHeight - document.getElementById("experiment-real-time-data").offsetHeight - 90;
        height = height - 20;
      } else {
        height = document.getElementById("chart_div").offsetWidth * 0.6;
      }
      return document.getElementById("chart_div").setAttribute("style", "height:" + height + "px");
    };

    Plot.prototype.resizeEvent = function() {
      var a, b, d;
      this.resize();
      if (this.initChart) {
        if (this.time > 18) {
          this.dataPlot.removeRow(17);
        } else {
          this.dataPlot.removeRow(this.time - 2);
        }
        this.chart.draw(this.dataPlot, this.options);
        this.dataPlot.addRow(this.data[this.time - 2]);
        d = new Date();
        b = d.getTime();
        a = this.realTime + (1000 * (this.time - 2) * 5) - b;
        if (a > 0) {
          this.options1 = {
            chartArea: {
              left: 40,
              top: 20,
              height: "80%",
              width: "85%"
            },
            legend: {
              position: 'none'
            },
            animation: {
              duration: a,
              easing: 'linear'
            }
          };
        } else {
          this.options1 = {
            chartArea: {
              left: 40,
              top: 20,
              height: "80%",
              width: "85%"
            },
            legend: {
              position: 'none'
            },
            animation: {
              duration: 1,
              easing: 'linear'
            }
          };
        }
        return this.chart.draw(this.dataPlot, this.options1);
      }
    };

    Plot.prototype.drawChart = function() {
      this.dataPlot = google.visualization.arrayToDataTable([['Time', 'Amps', 'Volts', 'Joules'], ['0', 0.000, 0.000, 0.000]]);
      this.data[this.time] = ['0', 0.000, 0.000, 0.000];
      this.time++;
      this.options = {
        chartArea: {
          left: 40,
          top: 20,
          height: "80%",
          width: "85%"
        },
        legend: {
          position: 'none'
        }
      };
      this.chart.draw(this.dataPlot, this.options);
      return google.visualization.events.addListener(this.chart, 'animationfinish', (function(_this) {
        return function() {
          console.log("dentro del lisenet");
          if (_this.time > 18) {
            _this.dataPlot.removeRow(0);
          }
          _this.data[_this.time] = ['' + _this.time, parseFloat(_this.inputCurrent.toFixed(3)), parseFloat(_this.inputVoltage.toFixed(3)), parseFloat(_this.workToDo.toFixed(3))];
          _this.dataPlot.addRow(_this.data[_this.time]);
          _this.time++;
          _this.options1 = {
            chartArea: {
              left: 40,
              top: 20,
              height: "80%",
              width: "85%"
            },
            legend: {
              position: 'none'
            },
            animation: {
              duration: 1900,
              easing: 'linear'
            }
          };
          return _this.chart.draw(_this.dataPlot, _this.options1);
        };
      })(this));
    };

    Plot.prototype.init = function() {
      this.data[this.time] = ['' + this.time, parseFloat(this.inputCurrent.toFixed(3)), parseFloat(this.inputVoltage.toFixed(3)), parseFloat(this.workToDo.toFixed(3))];
      this.dataPlot.addRow(this.data[this.time]);
      this.time++;
      this.options1 = {
        chartArea: {
          left: 40,
          top: 20,
          height: "80%",
          width: "85%"
        },
        legend: {
          position: 'none'
        },
        animation: {
          duration: 900,
          easing: 'linear'
        }
      };
      return this.chart.draw(this.dataPlot, this.options1);

      /*
      @alarma = setTimeout(=>
          @init = true
      
          @options1 = {
              chartArea:{left:40,top:20,height: "80%", width:"85%"},
              legend: {position: 'none'},
              
              animation:{
                  duration: 5000,
                  easing: 'linear',
              }
          
          }
          
          @data[@time] = [''+(@time*5), parseFloat((10*Math.random()).toFixed(2)) ,parseFloat((10*Math.random()).toFixed(2))]
          console.log @data[@time]
          @dataPlot.addRow @data[@time]
          @time++
          d = new Date()
          @realTime = d.getTime()
          @chart.draw(@dataPlot, @options1)
          @data[@time] = [''+(@time*5), parseFloat((10*Math.random()).toFixed(2)) ,parseFloat((10*Math.random()).toFixed(2))]
          @time++
          
      , 3000)
       */
    };

    return Plot;

  })();

  window.Plot = Plot;

}).call(this);
