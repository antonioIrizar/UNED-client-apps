<!DOCTYPE html>
<html>
  <head>
    <title>Solar Lab</title>
    <link rel="shortcut icon" href="favicon.ico" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Antonio Jesus Iŕizar López" />
    <meta name="description" content="Solar Laboratory" />
    <style>


      .vertical-align {
        
        display: flex;
        /* only work in ie 11... */
        align-items: center;
        /*need a 1px in right, because the slider not see correctly*/
        padding-right: 1px;
      }

      #myCanvas{
        position: absolute;
        left: 0;
        top: 0;
      }

      .wrapper{
        position: relative;
        padding-bottom: 10px;
      }

      .tooltipe {
      display: block;
      position: absolute;
      border: 1px solid #D9D9D9;
      font: 400 12px/12px Arial;
      border-radius: 3px;
      background: #fff;
      top: -28px;
      padding: 5px;
      left: -4px;
      text-align: center;
      width: 40px;
    }

    .tooltipe strong {
      display: block;
      padding: 2px;
    }

    .slidera {
      padding-top: 30px;
      height: 90px;
    }

    .modal-body {
      font-weight:normal;
    }

    #battery-warning {
        background: #FF4D4D;
    }

    #green {
        background: #03FF25;
    }

    #white {
        background: #F0F0F0;
    }

    #battery-ok{
      background: #3FB8AF;
    }

    .popover{
      width: 150px;
    }

    #save{
      font-size: 160%;
      float:right;
    }

    .button-accept{
      float:right;
    }
  </style>

<link href="css/timeTo.css" type="text/css" rel="stylesheet"/>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <link href="//weblab.ieec.uned.es/golab/ajirizar/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="css/bootstrap-theme.min.css" rel="stylesheet"/>
  <script src="javascripts/bootstrap.min.js"></script>
<script src="javascripts/jquery.timeTo.min.js"></script>

<link rel="stylesheet" media="screen" href="css/handsontable.full.min.css">
 <script src="javascripts/handsontable.full.min.js"></script>
 <link rel="stylesheet" media="screen" href="css/jquery.handsontable.bootstrap.css">
 
 <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script src="javascripts/jquery.nouislider.all.js"></script>
  <link href="css/jquery.nouislider.min.css" rel="stylesheet">
  <link href="css/jquery.nouislider.pips.min.css" rel="stylesheet">
  <script type="text/javascript">
    // Load the Visualization API and the piechart package.
    google.load('visualization', '1.0', {'packages':['corechart']});
  </script>
  <script src="javascripts/plot.js"></script>
  <script src="javascripts/sliders.js"></script>
  <script src="javascripts/esd.js"></script>
  <script src="javascripts/init.js"></script>
  </head>
  <body onload="arranque()">
    <script type="text/javascript">
   var myApp;
myApp = myApp || (function () {
    var pleaseWaitDiv = $('<div class="modal" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h1>Loading...</h1></div><div class="modal-body"><div class="progress progress-striped active"><div class="progress-bar" style="width: 100%;"></div></div></div></div></div></div>');
    return {
        showPleaseWait: function() {
            pleaseWaitDiv.modal();
        },
        hidePleaseWait: function () {
            pleaseWaitDiv.modal('hide');
        },

    };
    })();
    myApp.showPleaseWait();
</script>
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-4" id="div_formula_col">
          <div id="panel-elements" class="panel panel-primary">
            <div class="panel-heading">
              <h3 class="panel-title">Elements you can interact with</h3>
            </div>
            <div id="elements-interect" class="panel-body">
              <div class="row vertical-align">
                <div class="col-xs-3 col-lg-3">
                  <img src="images/bulb.png" class="img-responsive" alt="bulb">
                </div>
                <div class="col-xs-9 col-lg-9">
                  <form class="form" role="form" autocomplete="off">
                    <div class="form-group">
                      <strong>Lumens</strong>
                      <button onclick="sendLumens()" type="button" class="btn btn-info btn-xs button-accept">Accept</button>
                      <div class="slidera">
                        <div id="slider-lumens" class="slider slider-lumens"></div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
              <div class="row vertical-align">
                <div class="col-xs-3 col-lg-3">
                  <img src="images/solar_panel.png" class="img-responsive" alt="solar panel">
                </div>
                <div class="col-xs-9 col-lg-9">
                  <p class="text-center"><strong>Spin of the solar panel on:</strong></p>
                  <form class="form" role="form" autocomplete="off">
                    <div class="form-group">
                      <strong>Horizontal axis</strong>
                      <button onclick="sendHorizontalAxis()" type="button" class="btn btn-info btn-xs button-accept">Accept</button>
                      <div class="slidera">
                        <div id="slider-horizontal-axis" class="slider slider-horizontal-axis"></div>
                      </div>
                    </div>
                    <div class="form-group">
                      <strong>Vertical axis</strong>
                      <button onclick="sendVerticalAxis()" type="button" class="btn btn-info btn-xs button-accept">Accept</button>
                      <div class="slidera">
                        <div id="slider-vertical-axis" class="slider slider-vertical-axis"></div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
              <div class="row vertical-align">
                <div class="col-xs-3 col-lg-3">
                  <p class="text-center">10%</p>
                  <img id="img-battery" src="images/battery1.png" class="img-responsive" alt="battery">
                </div>
                <div class="col-xs-9 col-lg-9">
                  <form class="form" role="form">
                    <div class="form-group">
                      <strong>
                        How much charge do you want? 
                      </strong>
                      <a class="info-pop-up" data-container="body" data-toggle="popover"  tabindex="0" data-trigger="focus"  data-content="And here's some amazing content. It's very engaging. Right?">
                        <span class="glyphicon glyphicon-info-sign"></span>
                      </a>
                      <div class="slidera">
                        <div id="slider-battery" class="slider slider-battery"></div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
              <div class="row vertical-align">
                <div class="col-xs-3 col-lg-3">
         
                  <div id="countdown"></div>
    
                </div>
                <div class="col-xs-9 col-lg-9">
                  <form class="form" role="form">
                    <div class="form-group">
                      <strong>
                        Time charging
                      </strong>
                      <a href="#" data-toggle="modal" data-target="#myModal">
                        <span class="glyphicon glyphicon-info-sign"></span>
                      </a>
                        <!-- Modal -->
                        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                <h4 class="modal-title">TODO</h4>
                              </div>
                              <div class="modal-body">
                                <p>
                                  You can:
                                 </p>
                                  <ol>
                                    <li> Decide the charge you want in the battery. 
                                      <p>
                                        The battery will start charging till it reaches the selected value or you click on the stop button.
                                      </p>
                                    </li>
                                    
                                    <li>
                                      Decide for how long you want to change the battery.
                                      <p>
                                        The battery will charge for the selected lapse of time or till you click on the stop button.
                                      </p>
                                    </li>
                                    
                                    <li>Decide both, the change and the lapse of time.
                                      <p>
                                        The battery will charge till it reaches the first of both: the selected value or the selected lapse of time; or till you clicks on the stop button.
                                      </p>
                                    </li>
                                    
                                    <li>Decide none.
                                      <p>
                                      The battery will charge till it reaches its maximum or till you click on the stop button.
                                      </p>
                                    </li>
                                  </ol>
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      <div class="slidera">
                        <div id="slider-time" class="slider slider-time"></div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
              <div class="row">
                <div id="adapt-to-height"></div>
                <div class="center-block text-center">
                  <form class="form" role="form" autocomplete="off">
                    <button type="button" id="startExperiment" class="btn btn-success" onclick="startExperiments()">Start</button>
                    <button type="button" id="stop" class="btn btn-primary" onclick="stopExperiment()">Stop</button>
                    <button type="reset" id="reset" class="btn btn-danger" onclick="resetExperiment()">Reset</button>
                  </form>
                </div>
              </div> 
            </div>
          </div>
        </div>
        <div class="col-lg-8">
          <div class="row">
            <div class="col-lg-5">
              <div id="experiment-real-time-data" class="panel panel-info">
                <div class="panel-heading">
                  <h3 class="panel-title">Experiment real time data</h3>
                </div>
                <div class="panel-body ">
                  <div class="row">
                    <div class="col-lg-12">
                      <div class="wrapper">
                        <img id="esd" src="images/esd.png" class="img-responsive" alt="esd">
                        <canvas id="myCanvas"></canvas>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xs-4 col-lg-4">
                      <img id="turn" src="images/turn.png" class="img-responsive" alt="move weigth">
                    </div>
                    <div class="col-xs-8 col-lg-8">
                      <strong>
                        Move the weigth(comming soon)
                      </strong>
                      <a href="#" data-toggle="modal" data-target="#myModal">
                        <span class="glyphicon glyphicon-info-sign"></span>
                      </a>
                      <div class="slidera">
                        <div class="slider slider-weigth"></div>
                      </div>
                      <div class="center-block text-center">
                        <button type="button" class="btn btn-success disabled">Start</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <div class="col-lg-7" >
            <div  class="panel panel-success">
              <div class="panel-heading">
                <h3 class="panel-title">Webcam</h3>
              </div>
              <div id="panelGraph" class="panel-body ">
                <!--<img src="http://62.204.201.150:31/snapshot.cgi?&user=userSolar&pwd=&t=" onload='setTimeout(function() {src = src.substring(0, (src.lastIndexOf("t=")+2))+(new Date()).getTime()}, 1)' onerror='setTimeout(function() {src = src.substring(0, (src.lastIndexOf("t=")+2))+(new Date()).getTime()}, 5000)' alt='' class="img-responsive"/>-->
              <!--<img src="images/webcam.JPG" class="img-responsive">      -->
                <img src="http://62.204.201.150:31/videostream.cgi?user=userSolar&amp;pwd=" class="img-responsive" alt="">
<!--
<iframe marginheight="0" marginwidth="0" scrolling="auto" name="main" src="http://62.204.201.150:31/videostream.cgi?user=observer&pwd=" frameborder="0" height="480" width="640"></iframe>-->
              </div>
            </div>
          </div>
        </div>
          <div class="panel panel-info">
            <div class="panel-heading">
              <div id="save">
                <a href="#" data-toggle="modal" data-target="#myModalCSV">
                  <span class="glyphicon glyphicon-eye-open"></span>
                </a>
                <a href="#" data-toggle="modal" data-target="#myModal2">
                  <span class="glyphicon glyphicon-floppy-disk"></span>
                </a>
              </div>
              <h3 class="panel-title">
                Data received 
              </h3>
               
              <!-- Modal -->
              <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                      <h4 class="modal-title">Save data</h4>
                    </div>
                    <div class="modal-body">
                      <form role="form">
                        <div class="form-group">
                          <label for="inputNameOfFile">Name of file</label>
                          <input type="text" class="form-control" id="inputNameOfFile" placeholder="Name of file">
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="submit" onclick="saveTextAsFile()" data-dismiss="modal" class="btn btn-primary">Save</button>
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Modal -->
            </div>
            <div class="panel-body">
              <div id="chart_div"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="myModalCSV" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title">Save data</h4>
          </div>
          <div id="cacaVaca" class="modal-body">
            <div  style="width: 300px; height: 300px; overflow-x: auto;" class="handsontable" id="example1"></div>
          </div>
          <div class="modal-footer">
            <button type="submit" onclick="saveTextAsFile()" data-dismiss="modal" class="btn btn-primary">Save</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="myModalError" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title text-danger" id="myModalLabel">Error</h4>
          </div>
          <div  class="modal-body">
            <p class="text-danger">Lumens must be higher than 0.</p>
        </div>
      </div>
    </div>
  </div>

    <div class="modal fade" id="myModalConfirm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title text-success">Confirm changes</h4>
          </div>
          <div  class="modal-body">
            <p>You have not accepted the changes. Please select the new or the old values and click on <strong>"Accept"</strong>.</p>
            <form id="form-confirm-changes" role="form">
              <div id="div-confirm-changes">
              </div>
            </form>
        </div>
        <div class="modal-footer">
          <button type="submit" onclick="confirmAccept()" data-dismiss="modal" class="btn btn-info">Accept</button>
          <button type="button" onclick="cleanForm()" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

    <script>
    var lumens = null,
      verticalAxis = null,
      horizontalAxis = null,
      varInit = null;

  function disable(){
    $(".slider-battery").attr('disabled', 'disabled');
    $(".slider-lumens").attr('disabled', 'disabled');
    $(".slider-time").attr('disabled', 'disabled');
    $(".slider-horizontal-axis").attr('disabled', 'disabled');
    $(".slider-vertical-axis").attr('disabled', 'disabled');
    $("#startExperiment").attr('disabled', 'disabled');
    $(".button-accept").attr('disabled', 'disabled');
  };

  function enable(){
    $(".slider-battery").removeAttr('disabled');
    $(".slider-lumens").removeAttr('disabled');
    $(".slider-time").removeAttr('disabled');
    $(".slider-horizontal-axis").removeAttr('disabled');
    $(".slider-vertical-axis").removeAttr('disabled');
    $("#startExperiment").removeAttr('disabled');
    $(".button-accept").removeAttr('disabled');
  };

$('#countdown').timeTo({ 
  seconds: 3,
  countdown:true,
    fontSize: 14,
  });
 function wsopen(event)
{
  console.log("aqui");
  alert("websocket " + event + " is open");
  sendActuatorChange('SolarLab', "1");
 
  //ws.send('{"method": "getSensorMetadata"}'); // get sensor info
  //ws.send('{"method": "getActuatorMetadata"}'); // just pretend we don't know
  /*
  ws.send( '{  
      \"method\":\"sendActuatorData\",
      \"accessRole\":\"controller\",
      \"payload\":{  
         \"actuatorId\":\"Panelrot\",
         \"valueNames\":[  
            \"Rotation\"
         ],
         \"data\":[  
            120
         ]
      }');
*/
  /*
  var sensorRequest = {
     method: 'getSensorData',
    sensorId: 'sinus',
    accessRole: 'controller'
    }
   */
   //var jsonRequest = JSON.stringify({"method":"getSensorData","sensorId":"ESDval"});
/*
  var jsonRequest = JSON.stringify({  
      "method":"sendActuatorData",
      "accessRole":"controller",
       
         "actuatorId":"Panelrot",
         "valueNames":  
            ""
         ,
         "data": "30"
   });
*/
  //console.log(jsonRequest);
 //ws.send(jsonRequest);

}

function sendActuatorChange(actuatorId, data) {

 var actuatorRequest = {
    method: 'sendActuatorData',
    authToken: 'skfjs343kjKJ',
    accessRole: 'controller',
    actuatorId: actuatorId,
    valueNames: "",
    data: data  
  }

  var jsonRequest = JSON.stringify(actuatorRequest);
  ws.send(jsonRequest);

}

function getSensorData(sensorId){
  var jsonRequest = JSON.stringify({"method":"getSensorData", "accessRole": 'controller', "updateFrequency":"1", "sensorId":sensorId});
  ws.send(jsonRequest);
}

function wsmessage(event)
{
 var data = event.data+"";
console.log(data);
console.log("despues del parser");
var msg = JSON.parse(data);
console.log(msg);

if(msg.method == "sendActuatorData"){
  if (msg.responseMessages != null && msg.responseMessages.code == 409){
    alert("You can't controller the laboratory. Other user is used it")
    console.log("codigo 409");
    disable();
    $("#stop").attr('disabled', 'disabled');
    $("#reset").attr('disabled', 'disabled');
  }
}

if (msg.method == "getSensorData" && msg.sensorId == "ESDval"){
  if (msg.responseData.valueNames.length == 7){
    varInit.changeNumbers(msg.responseData.data[1], msg.responseData.data[0], msg.responseData.data[3])
  }
}

if (msg.method == "sendActuatorData" && msg.payload.actuatorId == "ESD"){
  if (msg.payload.responseData.data == 1){
    getSensorData("ESDval");
  }
}

if (msg.method == "sendActuatorData" && msg.payload.actuatorId == "Panelrot"){
  horizontalAxis = reciveData(msg.payload.responseData.data[0], horizontalAxis);
  $(".slider-horizontal-axis").val( horizontalAxis);
  myApp.hidePleaseWait();
}

if (msg.method == "sendActuatorData" && msg.payload.actuatorId == "Paneltilt"){
  verticalAxis = reciveData(msg.payload.responseData.data[0], verticalAxis);
  $(".slider-vertical-axis").val(-verticalAxis);
  myApp.hidePleaseWait();
}

if (msg.method == "sendActuatorData" && msg.payload.actuatorId == "Sun"){
  lumens = reciveData(msg.payload.responseData.data[0], lumens);
  $(".slider-lumens").val(lumens);
  myApp.hidePleaseWait();
}



/*
"{"method":"sendActuatorData","accessRole":"controller","payload":{"actuatorId":"ESD","responseData":{"valueNames":["State"],"data":[1],"lastMeasured":["13022015T095315"]}}}"


"{"method":"getSensorData","sensorId":"ESDval","accessRole":"","responseData":{"valueNames":["input voltage","input current","input wattage","worktodo"],"data":[1.7309999465942383,0,0,4],"lastMeasured":["12022015T151255","12022015T151255","12022015T151255","12022015T151255"]}}"

"{
 "method": "sendActuatorData",
 "responseMessages" :{
    "code": 409,
    "message": "AccesRole controller already assigned."
}
}"
if (msg.method == "getSensorMetadata") {
  document.querySelector('#sensorInfo').value = msg.sensors[0].description; // display description of the 1st sensor
  document.querySelector('#SensorMeta').value = JSON.stringify(msg);//msg.sensors[0].description; // display description of the 1st sensor
  }
else 
if (msg.method == "getActuatorMetadata") {
  document.querySelector('#ActuatorInfo').value = msg.actuators[0].description; // display description of the 1st sensor
  document.querySelector('#ActuatorMeta').value = JSON.stringify(msg);//msg.sensors[0].description; // display description of the 1st sensor
  }
else{

  if (msg.responseData) {
    document.querySelector('#sensorVal').value = msg.responseData.data[0];
  }
  else
    document.querySelector('#sensorVal').value ="err: " +msg.responseMessages.code + " " +msg.responseMessages.message  ;
    
    }
 
//  console.log("received: [", data, "]");
*/
}
function reciveData(dataRecive, actuator, slider){
  var result;
  if (actuator == null)
    result = dataRecive;
  else 
    result = actuator + dataRecive;

  //if (result
    return result;

}

function wsclose(event)
{
//   item = document.getElementById("receive");
//  item.firstChild.nodeValue +=  " websocket is closed";
alert("websocket " + event + " is closed");
}


function myInit2(evt) { 
ws = new WebSocket("ws://62.204.201.214:8081");
//ws = new WebSocket("ws://62.204.201.218:8081");

wsopen.ws = ws;
ws.onopen = wsopen;
/*ws.onopen =  function (event) 
     { alert("websocket " + event + " is open");
  ws.send("hello dear");

};*/
console.log("caca");
ws.onmessage = wsmessage;
ws.onclose = wsclose;
} 

  
/* deprecate */
/*
$(".slider-battery").Link('upper').to('-inline-<div class="tooltipe"></div>', function ( value ) {

  // The tooltip HTML is 'this', so additional
  // markup can be inserted here.
  $(this).html(
    '<span>' + Math.floor(value) + '</span>'
  );
});


$(".slider-battery").Link('lower').to('-inline-<div class="tooltipe"></div>', function ( value ) {

  // The tooltip HTML is 'this', so additional
  // markup can be inserted here.
  $(this).html(
    
       '<span id="muahaha" class="info-pop-up" data-trigger="manual" data-placement="top" tabindex="0" data-toggle="popover" data-content="You can\'t change this value">' + Math.floor(value) + '</span>'
  );
});


$(document).ready(function(){$('.info-pop-up').popover({trigger: 'manual'});
  var a;
  a = $('.slider-battery');
  a = a[0].getElementsByClassName('noUi-handle-lower');
  console.log(a[0]);
});

//console.log( document.getElementsByClassName("slider slider-battery noUi-target noUi-ltr noUi-horizontal noUi-background").id="red");

var cosa1,cosa2,valueBatery;
$('.slider-battery').on(
  "change", function(event){
    a = $('.slider-battery');
    a = a[0].getElementsByClassName('noUi-base');
    $(".slider-battery").val([valueBatery]);
    $(".slider-battery").Link('lower').to(function ( value ) {
  // The tooltip HTML is 'this', so additional
  // markup can be inserted here.
      if (value != valueBatery ){
        clearTimeout(cosa1);
        cosa1 = setTimeout(function(){
          $('#muahaha').popover('show');
          if (cosa2 == null)
            clearTimeout(cosa2);
          cosa2 = setTimeout(function(){
            $('#muahaha').popover('hide');
            cosa2 = null;
          },13000);
        },250);
      }
      else
        if (cosa2 != null)
          $('#muahaha').popover('show');
});
    //$('#muahaha').popover('show');
   
});

function initSliderBattery (){
  a = $('.slider-battery');
  a = a[0].getElementsByClassName("noUi-connect");
  a[0].setAttribute("class","noUi-origin noUi-background");
  setInterval(function () {
    var value = $(".slider-battery").val();
    b = $('.slider-battery');
    a = b[0].getElementsByClassName('noUi-base');
    auxValueBatery = Math.floor((Math.random() * value[1])+1);
    //valueBatery = 10;
    if (auxValueBatery != valueBatery){
      valueBatery = auxValueBatery;
      b.val([valueBatery]);
      if (valueBatery < 10)
        a[0].setAttribute("id", "battery-warning");
      else
        a[0].setAttribute("id", "battery-ok");
    }
  }, 3000);
}
initSliderBattery();
*/

function saveTextAsFile()
{
var textToWrite = "We don't have real data at this time :(. It's comming soon :)";
var textFileAsBlob = new Blob([textToWrite], {type:'text/plain'});
var fileNameToSaveAs = document.getElementById("inputNameOfFile").value + ".txt";
var browserName=navigator.appName;
if (browserName == "Microsoft Internet Explorer")
{
window.navigator.msSaveBlob(textFileAsBlob, fileNameToSaveAs );
}
else
{
var downloadLink = document.createElement("a");
downloadLink.download = fileNameToSaveAs;
downloadLink.innerHTML = "Download File";
if (window.webkitURL != null)
{
// Chrome allows the link to be clicked
// without actually adding it to the DOM.
downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
}
else
{
// Firefox requires the link to be added to the DOM
// before it can be clicked.
downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
downloadLink.onclick = destroyClickedElement;
downloadLink.style.display = "none";
document.body.appendChild(downloadLink);
}

downloadLink.click();
}
}
function destroyClickedElement(event)
{
  document.body.removeChild(event.target);
}
function battery(){

};

function confirmAccept(){
  var auxLumens, auxHorizontalAxis, auxVerticalAxis;
  auxLumens = getValueRadius("lumens");
  auxVerticalAxis = getValueRadius("verticalAxis");
  auxHorizontalAxis = getValueRadius("horizontalAxis");

  if (auxLumens!=null) {
    sendLumens();
  };

  if (auxVerticalAxis!=null) {
    sendVerticalAxis();
  };

  if (auxHorizontalAxis!=null) {
    sendHorizontalAxis();
  };
  sendActuatorChange('ESD', "1");
  cleanForm();
  disable();
};

function getValueRadius(name){
  rads = document.getElementsByName(name);

  var i = 0;
  while (i < rads.length){
      if (rads[i].checked) {
          return rads[i].value;
        }
      i++;
  }
};

function cleanForm(){
  form = document.getElementById('form-confirm-changes');
  form.removeChild(document.getElementById('div-confirm-changes'));
  divForm = document.createElement('div');
  divForm.setAttribute('id', 'div-confirm-changes');
  form.appendChild(divForm);
};

function startExperiments(){
  if ((lumens == null || lumens == 0) && $(".slider-lumens").val() == 0){
    $('#myModalError').modal('show');
  }
  else{
    var modal = false;

    if (lumens != null && lumens != $(".slider-lumens").val()){
      newForm("lumens-axis-form-confirm", "Lumens", $(".slider-lumens").val().toString() , lumens.toString(), "lumens");
      modal = true;
    }

    if (horizontalAxis != null && horizontalAxis!= $(".slider-horizontal-axis").val()){
      newForm("horizontal-axis-form-confirm", "Horizontal axis", $(".slider-horizontal-axis").val().toString() , horizontalAxis.toString(), "horizontalAxis");
      modal = true;
    }

    if (verticalAxis != null && verticalAxis != $(".slider-vertical-axis").val()){
      newForm("vertical-axis-form-confirm", "Vertical axis", $(".slider-vertical-axis").val().toString() , verticalAxis.toString(), "verticalAxis");
      modal = true;
    }

    if (modal){
      $('#myModalConfirm').modal('show');
    }
    else{
      sendLumens();
      sendHorizontalAxis();
      sendVerticalAxis();
      //sendActuatorChange('Sun', $(".slider-lumens").val());
      //sendActuatorChange('Panelrot', $(".slider-horizontal-axis").val());
      //try this line with minus
      //sendActuatorChange('Paneltilt',"-" + $(".slider-vertical-axis").val());
      //sendActuatorChange('ESDJ', $(".slider-battery").val());
      //sendActuatorChange('Elapsed', $(".slider-time").val());
      disable();
      sendActuatorChange('ESD', "1"); 
    }
  }
};

function resetExperiment(){
  enable();
  lumens = null;
  $(".slider-lumens").val(0);
 
  horizontalAxis = null
  $(".slider-horizontal-axis").val(0);
 
  verticalAxis = null;
  $(".slider-vertical-axis").val(0);

  $(".slider-battery").val(10);
  $(".slider-time").val(0);
  //Reset experiment
  sendActuatorChange('SolarLab', "0");
}
function errorLumens(){
  $('#myModalError').modal('show');
};
function sendLumens(){
  var auxLumens = $(".slider-lumens").val();
  //var move =  realValueToSend(auxLumens, lumens);
  if (auxLumens  != 0){
    sendActuatorChange('Sun', auxLumens.toString());
    myApp.showPleaseWait();
  }
};
function sendHorizontalAxis(){
  var oldHorizontalAxis = horizontalAxis;
  var auxHorizontalAxis = $(".slider-horizontal-axis").val();
  var move = realValueToSend(oldHorizontalAxis, auxHorizontalAxis);
  if (move != 0){
    sendActuatorChange('Panelrot', move.toString());
    myApp.showPleaseWait();
  }
};
function sendVerticalAxis(){
  var oldVerticalAxis = verticalAxis;
  var auxVerticalAxis = -$(".slider-vertical-axis").val();
  var move = realValueToSend(oldVerticalAxis, auxVerticalAxis);
  if (move != 0){
    sendActuatorChange('Paneltilt', move.toString());
    myApp.showPleaseWait();
  }
};

function realValueToSend(oldNumber, newNumber){
  if (oldNumber==null){
    return newNumber;
  }
  return newNumber - oldNumber;
};

function newForm(id, labelText, newValue, oldValue, name){
  divPrincipal = document.getElementById('div-confirm-changes');
  divForm = document.createElement('form');
  divForm.setAttribute('id', id);
  divForm.setAttribute('class', 'form-group');
  labelForm = document.createElement('label');
  text = document.createTextNode(labelText);
  labelForm.appendChild(text);
  divForm.appendChild(labelForm);
  divForm.appendChild(newRadio(newValue, true, " (New)", name));
  divForm.appendChild(newRadio(oldValue, false, " (Old)", name));
  divPrincipal.appendChild(divForm);
};

function newRadio(value, checked, newOrOld, name){
  divRadio = document.createElement('div');
  divRadio.setAttribute('class', 'radio');
  labelRadio = document.createElement('label');
  input = document.createElement('input');
  input.setAttribute('type', 'radio');
  input.setAttribute('name', name);
  input.setAttribute('value', value);
  if (checked){
    input.setAttribute('checked', true);
  }
  labelRadio.appendChild(input);
  text = document.createTextNode(value + newOrOld);
  labelRadio.appendChild(text);
  divRadio.appendChild(labelRadio);
  return divRadio;
};
function stopExperiment(){
  sendActuatorChange('ESD', "0");
  //var jsonRequest = JSON.stringify({"method":"getSensorData","sensorId":"ESDval"});
  //ws.send(jsonRequest);
  enable();
};

 var data = [
    [1, 2, 3, 4],
    [1, 2, 3, 4],
    [1, 2, 3, 4],
    [1, 2, 3, 4]
  ];
  
  $('#example1').handsontable({
    data: data,
    colHeaders: ["Time", "Jouls", "Amps", "Volts"],
    maxCols: 4,
    maxRows: 4,
    columns: [
      {readOnly: true,
      },
      {readOnly: true,
      },
      {readOnly: true,
      },
      {readOnly: true,
      }
      ],
  }
   );

  $('#myModalCSV').on('shown.bs.modal', function (e) {
    console.log(document.getElementById("cacaVaca").offsetWidth);
  
});

    function arranque(){
      
      varInit = new Init("myCanvas", "esd");
      myInit2();
      setTimeout(function(){
        myApp.hidePleaseWait()

      },1000);
      console.log($(".slider-lumens").val());

    };
  
    </script>
  </body>
</html>